<html>

<head>
	<title>Kickstarter to US Economy</title>
	<script src="https://d3js.org/d3.v4.min.js"></script>
	<link rel="stylesheet" type="text/css" href="styles/all.css" media="all"/>
</head>

<body>

	<h1 class="topPage"> Comparing Kickstarter with the state of the overall economy </h1>
	<p> A project by Ryan Slama (rms427) and Hamed Rabah (hr277) </p>
		<!-- <h1 class="sourceMaterial"> US Economy </h1>
	<h1 class="sourceMaterial"> Kickstarter Projects </h1> -->
	<h1 class="newMaterial"> Economy & Kickstarter Projects </h1>
	<script>
		monthlyData = {}
		monthlySPData = {}
		monthlyAverages = {}
		rawData = {}
		ksPlotData = []

		d3.csv("ks-projects-201801.csv", function (data) {
			rawData = data
			data.forEach(function (project) {
				// Convert String values to numbers
				project["ID"] = +project["ID"];
				project.goal = +project.goal;
				project.pledged = +project.pledged;
				project.backers = +project.backers;
				project["usd pledged"] = +project["usd pledged"];
				project.backers = +project.backers;
				project.usd_pledged_real = +project.usd_pledged_real;
				project.usd_goal_real = +project.usd_goal_real;

				// Convert String values to dates
				project.deadline = new Date(project.deadline);
				project.launched = new Date(project.launched);

				// Bin by year and month
				year = project.deadline.getFullYear()
				month = project.deadline.getMonth()

				if (!(year in monthlyData)) {
					monthlyData[year] = {}
				}
				if (!(month in monthlyData[year])) {
					monthlyData[year][month] = []
				}
				monthlyData[year][month].push(project)
			});
			// Generate average data per month
			Object.keys(monthlyData).forEach(function (year) {

				monthlyAverages[year] = {}
				usd_goal_real = 0
				usd_pledged_real = 0
				backers = 0
				funded = 0

				Object.keys(monthlyData[year]).forEach(function (month) {
					monthlyAverages[year][month] = {}

					usd_goal_real = 0
					usd_pledged_real = 0
					backers = 0
					funded = 0

					monthlyData[year][month].forEach(function (project) {
						usd_goal_real += project.usd_goal_real
						usd_pledged_real += project.usd_pledged_real
						backers += project.backers
						if (project.pledged > project.goal) {
							funded += 1;
						}
					})

					num = monthlyData[year][month].length

					monthlyAverages[year][month].usd_goal_real = usd_goal_real
					monthlyAverages[year][month].averageUsd_goal_real = usd_goal_real / num
					monthlyAverages[year][month].usd_pledged_real = usd_pledged_real
					monthlyAverages[year][month].averageUsd_pledged_real = usd_pledged_real / num
					monthlyAverages[year][month].backers = backers
					monthlyAverages[year][month].averageBackers = backers / num
					monthlyAverages[year][month].funded = funded
					monthlyAverages[year][month].percentFunded = funded / num

					var beginning = new Date("1/1/2010");
					var end = new Date("1/1/2017");
					humanMonth = Number(month) + 1
					var currentDate = new Date(humanMonth + "/1/" + year)

					if (currentDate > beginning && currentDate < end) {
						ksPlotData.push({date: currentDate, usd: usd_pledged_real / num})					
					}

				});
			});


			// Data row type
			// "ID": number
			// "name": string
			// "category": string
			// "main_category": string
			// "currency": string
			// "deadline": date
			// "goal": number
			// "launched": date
			// "pledged": number
			// "state": string
			// "backers": number
			// "country": string
			// "usd pledged": number
			// "usd_pledged_real": number
			// "usd_goal_real": number
			spPlotData = []
			d3.csv("SPIndex.csv", function (SPData) {
				SPData.forEach(function (day) {
					// Convert String values to numbers
					day.adjclose = +day.adjclose
					day.close = +day.close
					day.high = +day.high
					day.low = +day.low
					day.volume = +day.volume
					day.open = +day.open

					// Convert String values to dates
					day.Date = new Date(day.Date);

					// Bin by year and month
					year = day.Date.getFullYear()
					month = day.Date.getMonth()

					if (!(year in monthlySPData)) {
						monthlySPData[year] = {}
					}
					if (!(month in monthlySPData[year])) {
						monthlySPData[year][month] = []
					}
					monthlySPData[year][month].push(day)

					var beginning = new Date("1/1/2010");
					var end = new Date("1/1/2017");

					if (day.Date > beginning && day.Date < end) {
						spPlotData.push(day)
					}
				});

				// Plotting begins here
				canvas = d3.select("#canvas")
				var time = d3.scaleTime().domain([new Date("1/1/2010"), new Date("1/1/2017")]).range([0,760])
				var sp = d3.scaleLinear().domain([0, 2400]).range([580,20])
				var ks = d3.scaleLinear().domain([0, 15000]).range([580,20])

				canvas.append("g")
					.attr("transform", "translate(60,620)")
					.call(d3.axisBottom(time))
					.attr("class", "axis")

				canvas.append("g")
					.attr("transform", "translate(60,40)")
					.call(d3.axisLeft(sp))
					.attr("class", "axis")

				canvas.append("g")
					.attr("transform", "translate(820,40)")
					.call(d3.axisRight(ks))
					.attr("class", "axis")

				var spLine = d3.line()
					.x(function(d) { return time(d.Date); })
					.y(function(d) { return sp(d.open); });

				canvas.append("path")
					.data([spPlotData])
					.attr("class", "sp")
					.attr("d", spLine)
					.attr("fill", "none")
					.attr("stroke", "lightgreen")
					.attr("transform", "translate(60,40)")

				var ksLine = d3.line()
					.x(function(d) { return time(d.date); })
					.y(function(d) { return ks(d.usd); });

				canvas.append("path")
					.data([ksPlotData])
					.attr("class", "sp")
					.attr("d", ksLine)
					.attr("fill", "none")
					.attr("stroke", "Fuchsia")
					.attr("transform", "translate(60,40)")

				canvas.append("text")             
					.attr("transform", "translate(440,660)")
					.style("text-anchor", "middle")
					.text("Date")
					.attr("fill","#cccccc");

				canvas.append("text")             
					.attr("transform", "translate(870,340), rotate(90)")
					.style("text-anchor", "middle")
					.text("Kickstarter Average Real USD Pledged")
					.attr("fill","#cccccc");

				canvas.append("text")             
					.attr("transform", "translate(10,340), rotate(90)")
					.style("text-anchor", "middle")
					.text("S&P 500 Index")
					.attr("fill","#cccccc");

			});
		});
	</script>
	<svg id="canvas" width="880" height="680"></svg>
</body>

</html>
